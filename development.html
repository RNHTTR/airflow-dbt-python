<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Development &mdash; airflow-dbt-python 0.15.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/hack-font/3.3.0/web/hack.min.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Reference" href="reference.html" />
    <link rel="prev" title="Example DAGs" href="example_dags.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> airflow-dbt-python
          </a>
              <div class="version">
                0.15.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting_started.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="example_dags.html">Example DAGs</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Development</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#poetry">Poetry</a></li>
<li class="toctree-l2"><a class="reference internal" href="#installing-airflow">Installing Airflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="#building-from-source">Building from source</a></li>
<li class="toctree-l2"><a class="reference internal" href="#modifying-dependencies">Modifying dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pre-commit-hooks">Pre-commit hooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="#testing">Testing</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-unit-tests-with-pytest">Running unit tests with pytest</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="reference.html">Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">airflow-dbt-python</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Development</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/development.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="development">
<span id="id1"></span><h1>Development<a class="headerlink" href="#development" title="Permalink to this heading"></a></h1>
<p>This section describes how to setup a development environment. If you are looking to dig into the internals of airflow-dbt-python and make a (very appreciated) contribution to the project, read along.</p>
<section id="poetry">
<h2>Poetry<a class="headerlink" href="#poetry" title="Permalink to this heading"></a></h2>
<p>airflow-dbt-python uses <a class="reference external" href="https://python-poetry.org/">Poetry</a> for project management. Ensure it’s installed before running: see <a class="reference external" href="https://python-poetry.org/docs/#installation">Poetry’s installation documentation</a>.</p>
<p>As of <cite>airflow-dbt-python</cite> version 0.14, we have moved the project to Poetry version &gt;= 1.2.0 to allow us to use dependency groups.</p>
</section>
<section id="installing-airflow">
<h2>Installing Airflow<a class="headerlink" href="#installing-airflow" title="Permalink to this heading"></a></h2>
<p>Development requires a local installation of Airflow, as airflow-dbt-python doesn’t come bundled with one. We can install a specific version using <code class="docutils literal notranslate"><span class="pre">pip</span></code>:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pip install apache-airflow<span class="o">==</span><span class="m">2</span>.2
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Installing any 1.X version of Airflow will raise warnings due to dependency conflicts with <code class="docutils literal notranslate"><span class="pre">dbt-core</span></code>. However, these conflicts should not impact airflow-dbt-python.</p>
</div>
<p>Installing the <code class="docutils literal notranslate"><span class="pre">airflow</span></code> extra will fetch the latest version of Airflow with major version 2:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>poetry install -E airflow
</pre></div>
</div>
<p>Some features require Airflow providers. For example, any S3 backend operations require <code class="docutils literal notranslate"><span class="pre">apache-airflow-providers-amazon</span></code>. These providers may be installed individually or with the <code class="docutils literal notranslate"><span class="pre">airflow-providers</span></code> extra:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>poetry install -E airflow-providers -E airflow
</pre></div>
</div>
</section>
<section id="building-from-source">
<h2>Building from source<a class="headerlink" href="#building-from-source" title="Permalink to this heading"></a></h2>
<p>Clone the main repo and install it:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>git clone https://github.com/tomasfarias/airflow-dbt-python.git
<span class="nb">cd</span> airflow-dbt-python
poetry install --with dev -E airflow-providers -E postgres -E airflow
</pre></div>
</div>
<p>The dev dependency group includes development tools for code formatting, type checking, and testing. The added extras are required for testing, although if Airflow is being installed separately it should be omitted.</p>
</section>
<section id="modifying-dependencies">
<h2>Modifying dependencies<a class="headerlink" href="#modifying-dependencies" title="Permalink to this heading"></a></h2>
<p>Apache Airflow is a package of significant size that requires a lot of dependencies. Together with <code class="docutils literal notranslate"><span class="pre">dbt-core</span></code>, it’s common to find dependency conflicts all over the place. Ultimately, we allow users to figure these issues out themselves, as most of the dependency conflicts are harmless: We do not interact with the dbt CLI, so any conflicts with CLI-specific packages can be safely ignored, but these requirements are not optional for <code class="docutils literal notranslate"><span class="pre">dbt-core</span></code>.</p>
<p>All being said, this presents a problem when we try to add dependencies or modify existing ones, as <code class="docutils literal notranslate"><span class="pre">poetry</span></code> will take a long time to check all possible conflicts. Grabbing a constraints file from <a class="reference external" href="https://github.com/apache/airflow">Airflow</a> and adding it as an optional group in <code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> can be a useful strategy to speed up the process, as we are limiting the search domain for <code class="docutils literal notranslate"><span class="pre">poetry</span></code>. However, this does require relaxing dependencies one by one in between running <code class="docutils literal notranslate"><span class="pre">poetry</span> <span class="pre">lock</span> <span class="pre">--no-update</span></code>.</p>
</section>
<section id="pre-commit-hooks">
<h2>Pre-commit hooks<a class="headerlink" href="#pre-commit-hooks" title="Permalink to this heading"></a></h2>
<p>A handful of <a class="reference external" href="https://pre-commit.com/">pre-commit</a> hooks are provided, including:</p>
<ul class="simple">
<li><p>Trailing whitespace trimming.</p></li>
<li><p>Ensure EOF newline.</p></li>
<li><p>Detect secrets.</p></li>
<li><p>Code formatting (<a class="reference external" href="https://github.com/psf/black">black</a>).</p></li>
<li><p>PEP8 linting (<a class="reference external" href="https://github.com/pycqa/flake8/">flake8</a>).</p></li>
<li><p>Static type checking (<a class="reference external" href="https://github.com/python/mypy">mypy</a>).</p></li>
<li><p>Import sorting (<a class="reference external" href="https://github.com/PyCQA/isort">isort</a>).</p></li>
</ul>
<p>Install hooks after cloning airflow-dbt-python:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>pre-commit install
</pre></div>
</div>
<p>Ensuring hooks pass is highly recommended as hooks are mapped to CI/CD checks that will block PRs.</p>
</section>
<section id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Permalink to this heading"></a></h2>
<p>Unit tests are available for all operators and hooks. That being said, only a fraction of the large amount of possible inputs that the operators and hooks can take is currently covered, so the unit tests do not offer perfect coverage (a single peek at the <code class="docutils literal notranslate"><span class="pre">DbtBaseOperator</span></code> should give you an idea of the level of state explosion we manage).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Unit tests (and airflow-dbt-python) assume dbt works correctly and do not assert the behavior of the dbt commands themselves.</p>
</div>
<section id="requirements">
<h3>Requirements<a class="headerlink" href="#requirements" title="Permalink to this heading"></a></h3>
<p>Unit tests interact with a <a class="reference external" href="https://www.postgresql.org/">PostgreSQL</a> database as a target to run dbt commands. This requires PostgreSQL to be installed in your local environment. Installation instructions for all major platforms can be found here: <a class="reference external" href="https://www.postgresql.org/download/">https://www.postgresql.org/download/</a>.</p>
<p>Some unit tests require the <a class="reference external" href="https://pypi.org/project/apache-airflow-providers-amazon/">Amazon provider package for Airflow</a>. Ensure it’s installed via the <code class="docutils literal notranslate"><span class="pre">airflow-providers</span></code> extra:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>poetry install --with dev -E airflow-providers -E postgres -E airflow
</pre></div>
</div>
</section>
<section id="running-unit-tests-with-pytest">
<h3>Running unit tests with pytest<a class="headerlink" href="#running-unit-tests-with-pytest" title="Permalink to this heading"></a></h3>
<p>airflow-dbt-python uses <a class="reference external" href="https://docs.pytest.org/">pytest</a> as its testing framework. After you have saved your changes, all unit tests can be run with:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>poetry run pytest tests/ -vv
</pre></div>
</div>
<p>Generating coverage reports with pytest-cov can be done with:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>poetry run pytest -vv --cov<span class="o">=</span>./airflow_dbt_python --cov-report<span class="o">=</span>xml:./coverage.xml --cov-report term-missing tests/
</pre></div>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="example_dags.html" class="btn btn-neutral float-left" title="Example DAGs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="reference.html" class="btn btn-neutral float-right" title="Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Copyright 2021 Tomás Farías Santana.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>